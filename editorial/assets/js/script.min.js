var iDevice=(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))?true:false;if(iDevice){var viewportmeta=document.querySelectorAll('meta[name="viewport"]')[0];if(viewportmeta){viewportmeta.content="width=device-width,minimum-scale=1.0,maximum-scale=1.0";document.body.addEventListener("gesturestart",function(){viewportmeta.content="width=device-width,minimum-scale=0.25,maximum-scale=1.6"},false)}}$(function(){setTimeout(function(){window.scrollTo(0,1)},0);if(iDevice){$("label[for]").click(function(){var el=$(this).attr("for");if($("#"+el+"[type=radio], #"+el+"[type=checkbox]").attr("selected",!$("#"+el).attr("selected"))){return}else{$("#"+el)[0].focus()}})}$("#embed-code").click(function(){$(this).select()});if($("blockquote.bad-comment").length>0){var b="blockquote.bad-comment>p";var s="p.show>a";$(b).hide();$(s+">span").text("Show hidden");$(s).click(function(e){e.preventDefault();if($(b).css("display")=="block"){$(b).fadeOut("fast");$(s+">span").text("Show hidden")}else{$(b).fadeIn("fast");$(s+">span").text("Hide shown")}})}$("#comments-form").submit(function(){dataString="name="+$("#name").val()+"&email="+$("#email").val()+"&url="+$("#url").val()+"&comment="+$("#comment").val()+"&riddle="+$("#riddle").val()+"&comment_post_ID="+$("#comment_post_ID").val();$.ajax({type:"POST",url:$("#comments-form").attr("action"),data:dataString,complete:function(msg){var response=$.parseJSON(msg.responseText);$("#errors").remove();$("#comment").parent().removeClass("error");$("#name").parent().removeClass("error");$("#email").parent().removeClass("error");$("#url").parent().removeClass("error");$("#riddle").parent().removeClass("error");if(response.errors){$(response.html).insertBefore("#comments-form");$("html,body").animate({scrollTop:$("#errors").offset().top},"slow");for(error in response.error_fields){var id=response.error_fields[error];$("#"+id).parent().addClass("error")}}else{$("#success").remove();$(response.success).insertBefore("#comments-form");if($("#comments").length>0){$(response.html).insertBefore("#comments article:first-child")}else{$("#single .notice").html(response.notice).after('<section id="comments">'+response.html+"</section>")}$("html,body").animate({scrollTop:$("#success").offset().top},"slow");setTimeout(function(){$("#success").fadeOut(500)},5000);$("#comment").val("");$("#name").val("");$("#email").val("");$("#url").val("");$("#riddle").val("")}$('#comments-form .captcha label[for="riddle"]').html(response.riddle.notice);$("#comments-form .qa span").html(response.riddle.riddle);$("#riddle").val("")}});return false});if($("#media-gallery").length>0){function centerMedia(which){var w=(which)?1:0;if(w==1){var active=$("#media-elements>figure")}else{var active=$("#media-elements>.active")}active.find("img").height("auto");var maxH=$(window).height()/2;var imgH=active.find("img").height()/2;var margin=maxH-imgH;if(margin>0){active.css("marginTop",margin)}else{active.css("marginTop",0);active.find("img").height(maxH*2)}}centerMedia(1);$("a.m-toggle").click(function(e){e.preventDefault();$(this).toggleClass("pressed").prev("p").slideToggle(100)});$("#m-prev").click(function(e){e.preventDefault();slideShow(-1)});$("#m-slide").click(function(e){e.preventDefault();slideShow(0)});$("#m-next").click(function(e){e.preventDefault();slideShow(1)});$("a.m-embed").click(function(e){e.preventDefault()});function slideShow(go){var el=$("#media-elements>.active");switch(go){case (0):looping(el);break;case (1):goNext(el);break;case (-1):goPrev(el);break}}var loop=setTimeout("",1);function looping(el){}function goNext(el){if(el.next().length>0){el.removeClass("active").css("display","");el.next().fadeIn(function(){$(this).addClass("active")})}}function goPrev(el){if(el.prev().length>0){el.removeClass("active").css("display","");el.prev().fadeIn(function(){$(this).addClass("active")})}}$(window).resize(function(){centerMedia()})}$("form.favorize input:radio").each(function(){$(this).change(function(){$(this).parent().submit()})});$("form.favorize").each(function(){var score=$("strong.score",$(this));score.after(score.clone().removeClass("score").addClass("coin"));var coin=score.next();$(this).submit(function(e){e.preventDefault();var selectedInput=$("input:radio:checked",$(this));var value=selectedInput.val();var key=selectedInput.attr("name");var vote={};vote[key]=value;$.post($(this).attr("action"),vote,function(msg){var response=$.parseJSON(msg);if(response.ok){$("#score-"+response.id).html(response.votes);var scorePlus=(selectedInput.attr("id").lastIndexOf("vote-for")==0)?true:false;var bgr=scorePlus?"#79a500":"#d00";if(scorePlus){coin.removeClass("negative").text("+1").show().animate({top:"-20px",opacity:0},300)}else{coin.addClass("negative").text("-1").show().animate({top:"-20px",opacity:0},300)}var posScoreNum=(score.text()>=0)?true:false;if(posScoreNum){score.removeClass("negative")}else{score.addClass("negative")}}else{}});$("input",this).attr("disabled",true);$("fieldset:first-child",this).addClass("disabled")})});function paging(){$("#paging a").click(function(){$.ajax({url:$(this).attr("href"),success:function(data){$("#paging").remove();$("div.content").append(data);paging()}});return false})}paging();if($("#gallery").length){$(document).keydown(function(e){var key=e.keyCode||e.which;var el=$("#media-elements>.active");if(key===37){alert("left");e.stopImmediatePropagation();return false}if(key===39){alert("right");e.stopImmediatePropagation();return false}})}});